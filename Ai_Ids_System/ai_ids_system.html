<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Í∏∞Î∞ò ÏúÑÌóò Ìå®ÌÑ¥ ÌÉêÏßÄ ÏãúÏä§ÌÖú</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            color: #7f8c8d;
            text-align: center;
            font-size: 1.1em;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        .risk-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f39c12;
            animation: pulse 2s infinite;
        }

        .risk-indicator.high { background: #e74c3c; }
        .risk-indicator.medium { background: #f39c12; }
        .risk-indicator.low { background: #27ae60; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .file-upload {
            border: 2px dashed #e74c3c;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: rgba(231, 76, 60, 0.05);
        }

        .file-upload:hover {
            border-color: #c0392b;
            background: rgba(231, 76, 60, 0.1);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: #e74c3c;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .analysis-section {
            grid-column: 1 / -1;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .risk-metric-card {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
        }

        .log-normal { background: rgba(46, 204, 113, 0.2); }
        .log-warning { background: rgba(241, 196, 15, 0.2); }
        .log-danger { background: rgba(231, 76, 60, 0.2); }
        .log-high-risk { background: rgba(231, 76, 60, 0.4); animation: blink 2s infinite; }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-simulation {
            background: #9b59b6;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .ai-analysis {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .ai-analysis h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-thinking {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .network-viz {
            width: 100%;
            height: 300px;
            background: #34495e;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .network-node {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #3498db;
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        .network-node.high-risk {
            background: #e74c3c;
            animation: blink 1s infinite;
            width: 15px;
            height: 15px;
        }

        .network-node.medium-risk {
            background: #f39c12;
            animation: pulse 2s infinite;
            width: 12px;
            height: 12px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .pattern-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .similarity-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .similarity-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è AI Í∏∞Î∞ò ÏúÑÌóò Ìå®ÌÑ¥ ÌÉêÏßÄ ÏãúÏä§ÌÖú</h1>
            <p>CSV ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÎåÄÎπÑ Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ Ïú†ÏÇ¨ÎèÑ Î∂ÑÏÑù Î∞è ÏúÑÌóò ÌÉêÏßÄ</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2>
                    <span class="status-indicator" id="systemStatus"></span>
                    ÏãúÏä§ÌÖú ÏÉÅÌÉú
                </h2>
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="totalPackets">0</div>
                        <div class="metric-label">Ï¥ù Ìå®ÌÇ∑ Ïàò</div>
                    </div>
                    <div class="risk-metric-card">
                        <div class="metric-value" id="riskMatches">0</div>
                        <div class="metric-label">ÏúÑÌóò Ìå®ÌÑ¥ Îß§Ïπò</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgSimilarity">0%</div>
                        <div class="metric-label">ÌèâÍ∑† Ïú†ÏÇ¨ÎèÑ</div>
                    </div>
                </div>

                <div class="pattern-status">
                    <h4>üìä ÌòÑÏû¨ ÏúÑÌóòÎèÑ: <span id="currentRiskLevel">UNKNOWN</span></h4>
                    <div class="similarity-bar">
                        <div class="similarity-fill" id="similarityFill" style="width: 0%"></div>
                    </div>
                    <p style="margin-top: 5px; font-size: 12px;">CSV ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÎåÄÎπÑ Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ Ïú†ÏÇ¨ÎèÑ</p>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Ìå®ÌÑ¥ Îß§Ïπ≠ ÏãúÍ∞ÅÌôî</h2>
                <div class="network-viz" id="networkViz"></div>
                <p>ÏúÑÌóò Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑÏóê Îî∞Î•∏ Ïã§ÏãúÍ∞Ñ ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú</p>
            </div>
        </div>

        <div class="card analysis-section">
            <h2>ü§ñ AI ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù</h2>
            
            <div class="file-upload">
                <p>‚ö†Ô∏è ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÏóÖÎ°úÎìú (CSV)</p>
                <input type="file" id="csvFile" accept=".csv" />
                <button class="upload-btn" onclick="document.getElementById('csvFile').click()">
                    ÏúÑÌóò Ìå®ÌÑ¥ ÌååÏùº ÏÑ†ÌÉù
                </button>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    üö® CSV Îç∞Ïù¥ÌÑ∞Îäî ÏúÑÌóòÌïú Í≥µÍ≤© Ìå®ÌÑ¥Ïùò Í∏∞Ï§ÄÏÑ†ÏúºÎ°ú ÏÇ¨Ïö©Îê©ÎãàÎã§
                </p>
            </div>

            <div style="margin-bottom: 20px;">
                <input type="password" class="api-key-input" id="apiKey" placeholder="Google Gemini API ÌÇ§ ÏûÖÎ†•" value="AIzaSyDPUXHrBZ3P4luxl9aTvrqsTPRZtDNAo18">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    ü§ñ Gemini APIÎ°ú ÏúÑÌóò Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑ Î∂ÑÏÑù Î∞è ÏúÑÌóòÎèÑ ÌèâÍ∞Ä
                </p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="startPatternAnalysis()">üîç ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù</button>
                <button class="btn btn-success" onclick="startThreatMonitoring()">üì° ÏúÑÌóò Î™®ÎãàÌÑ∞ÎßÅ</button>
                <button class="btn btn-danger" onclick="stopMonitoring()">‚èπÔ∏è Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ</button>
                <button class="btn btn-simulation" onclick="startThreatSimulation()">üé≠ ÏúÑÌóò ÏãúÎÆ¨Î†àÏù¥ÏÖò</button>
                <button class="btn btn-primary" onclick="generateThreatPatterns()">‚ö†Ô∏è ÏúÑÌóò Ìå®ÌÑ¥ ÏÉòÌîå</button>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-entry log-normal">[2025-06-29 10:00:00] ÏúÑÌóò Ìå®ÌÑ¥ ÌÉêÏßÄ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å</div>
                <div class="log-entry log-warning">[2025-06-29 10:00:01] ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÎåÄÍ∏∞ Ï§ë...</div>
                <div class="log-entry log-normal">[2025-06-29 10:00:02] AI Ìå®ÌÑ¥ Îß§Ïπ≠ ÏïåÍ≥†Î¶¨Ï¶ò Ï§ÄÎπÑ ÏôÑÎ£å</div>
            </div>

            <div class="ai-analysis" id="aiAnalysis" style="display: none;">
                <h3>
                    <span class="ai-thinking">ü§ñ</span>
                    AI ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù Í≤∞Í≥º
                </h3>
                <div id="analysisResults">ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù ÏßÑÌñâ Ï§ë...</div>
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        var monitoringActive = false;
        var simulationActive = false;
        var threatBaseline = [];
        var realtimeTraffic = [];
        var simulationData = [];
        var totalPackets = 0;
        var riskMatches = 0;
        var currentRiskLevel = 'UNKNOWN';
        var averageSimilarity = 0;

        // Ìå®ÌÑ¥ Îß§Ïπ≠ Í∞ÄÏ§ëÏπò
        var WEIGHTS = {
            protocol: 0.30,
            port: 0.25,
            packetSize: 0.20,
            ipPattern: 0.15,
            attackType: 0.10
        };

        // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏãúÍ∞ÅÌôî Ï¥àÍ∏∞Ìôî
        function initNetworkVisualization() {
            var container = document.getElementById('networkViz');
            for (var i = 0; i < 20; i++) {
                var node = document.createElement('div');
                node.className = 'network-node';
                node.style.left = Math.random() * 90 + '%';
                node.style.top = Math.random() * 90 + '%';
                node.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(node);
            }
        }

        // CSV ÌååÏùº Ï≤òÎ¶¨
        function setupFileUpload() {
            document.getElementById('csvFile').addEventListener('change', function(e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var csv = e.target.result;
                        parseThreatBaseline(csv);
                    };
                    reader.readAsText(file);
                }
            });
        }

        // CSV ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÌååÏã±
        function parseThreatBaseline(csv) {
            var lines = csv.split('\n');
            var data = [];

            for (var i = 0; i < lines.length; i++) {
                if (lines[i].trim()) {
                    var values = lines[i].split(',');
                    
                    if (values.length >= 3) {
                        var row = {
                            uid: values[0] || 'threat_' + i,
                            timestamp: values[1] || Date.now(),
                            protocol: values[2] || 'Unknown',
                            sourceIP: values[3] || '0.0.0.0',
                            destinationIP: values[4] || '0.0.0.0',
                            sourcePort: parseInt(values[5]) || 0,
                            destinationPort: parseInt(values[6]) || 0,
                            packetSize: parseInt(values[7]) || 500,
                            directionType: parseInt(values[8]) || 0,
                            eventCount: parseInt(values[9]) || 1,
                            attackType: detectThreatType(values[2], values[5], values[6], values[7]),
                            severity: 'HIGH',
                            patternSignature: generatePatternSignature(values),
                            dataType: 'threat_baseline'
                        };
                        data.push(row);
                    }
                }
            }

            threatBaseline = data;
            addLog('‚ö†Ô∏è ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† ÏÑ§Ï†ï ÏôÑÎ£å (' + data.length + 'Í∞ú ÏúÑÌóò Ìå®ÌÑ¥) - Ïã§ÏãúÍ∞Ñ ÎπÑÍµê Ï§ÄÎπÑÎê®', 'danger');
            updateSystemStatus('BASELINE_LOADED');
            updateMetrics();
        }

        // ÏúÑÌóò Ïú†Ìòï Í∞êÏßÄ
        function detectThreatType(protocol, sourcePort, destPort, packetSize) {
            var size = parseInt(packetSize) || 0;
            var dport = parseInt(destPort) || 0;
            
            if (protocol === 'TCP') {
                if (dport === 22) return 'SSH_BRUTE_FORCE';
                if (dport === 80 || dport === 443) return 'HTTP_FLOOD';
                if (size > 1400) return 'TCP_FLOOD';
                return 'TCP_SCAN';
            }
            
            if (protocol === 'LDAP') return 'LDAP_INJECTION';
            if (protocol === 'DNS') return size > 512 ? 'DNS_AMPLIFICATION' : 'DNS_TUNNEL';
            if (protocol === 'CDP') return 'CDP_FLOOD';
            if (protocol === 'ARP') return 'ARP_POISONING';
            
            return 'ADVANCED_THREAT';
        }

        // Ìå®ÌÑ¥ ÏãúÍ∑∏ÎãàÏ≤ò ÏÉùÏÑ±
        function generatePatternSignature(values) {
            return {
                protocol: values[2] || 'Unknown',
                portRange: categorizePort(parseInt(values[6]) || 0),
                sizeCategory: categorizePacketSize(parseInt(values[7]) || 0),
                ipClass: categorizeIP(values[3] || '0.0.0.0')
            };
        }

        // Ìè¨Ìä∏ Î∂ÑÎ•ò
        function categorizePort(port) {
            if (port <= 1023) return 'SYSTEM';
            if (port <= 49151) return 'REGISTERED';
            return 'DYNAMIC';
        }

        // Ìå®ÌÇ∑ ÌÅ¨Í∏∞ Î∂ÑÎ•ò
        function categorizePacketSize(size) {
            if (size < 100) return 'TINY';
            if (size < 500) return 'SMALL';
            if (size < 1500) return 'MEDIUM';
            return 'LARGE';
        }

        // IP Î∂ÑÎ•ò
        function categorizeIP(ip) {
            if (ip.startsWith('192.168.')) return 'PRIVATE_A';
            if (ip.startsWith('10.')) return 'PRIVATE_B';
            if (ip.startsWith('172.')) return 'PRIVATE_C';
            return 'PUBLIC';
        }

        // ÏúÑÌóò Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
        function calculateThreatSimilarity(realtimeEvent, threatPattern) {
            var similarity = 0;
            
            // ÌîÑÎ°úÌÜ†ÏΩú Îß§Ïπò (30%)
            if (realtimeEvent.protocol === threatPattern.protocol) {
                similarity += WEIGHTS.protocol;
            }
            
            // Ìè¨Ìä∏ Ïú†ÏÇ¨ÏÑ± (25%)
            var realtimePortCategory = categorizePort(realtimeEvent.destinationPort);
            var threatPortCategory = categorizePort(threatPattern.destinationPort);
            if (realtimePortCategory === threatPortCategory) {
                similarity += WEIGHTS.port;
            }
            
            // Ìå®ÌÇ∑ ÌÅ¨Í∏∞ Ïú†ÏÇ¨ÏÑ± (20%)
            var realtimeSizeCategory = categorizePacketSize(realtimeEvent.packetSize);
            var threatSizeCategory = categorizePacketSize(threatPattern.packetSize);
            if (realtimeSizeCategory === threatSizeCategory) {
                similarity += WEIGHTS.packetSize;
            }
            
            // IP Ìå®ÌÑ¥ Ïú†ÏÇ¨ÏÑ± (15%)
            var realtimeIPCategory = categorizeIP(realtimeEvent.sourceIP);
            var threatIPCategory = categorizeIP(threatPattern.sourceIP);
            if (realtimeIPCategory === threatIPCategory) {
                similarity += WEIGHTS.ipPattern;
            }
            
            // Í≥µÍ≤© Ïú†Ìòï Îß§Ïπò (10%)
            if (realtimeEvent.attackType === threatPattern.attackType) {
                similarity += WEIGHTS.attackType;
            }
            
            return similarity;
        }

        // ÏúÑÌóòÎèÑ ÌèâÍ∞Ä
        function assessRiskLevel(similarity) {
            if (similarity >= 0.70) return 'HIGH';
            if (similarity >= 0.50) return 'MEDIUM';
            return 'LOW';
        }

        // ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù ÏãúÏûë
        function startPatternAnalysis() {
            if (threatBaseline.length === 0) {
                alert('ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ†Ïù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. CSV ÌååÏùºÏùÑ Î®ºÏ†Ä ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (realtimeTraffic.length === 0 && simulationData.length === 0) {
                alert('Î∂ÑÏÑùÌï† Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏúÑÌóò Î™®ÎãàÌÑ∞ÎßÅÏù¥ÎÇò ÏãúÎÆ¨Î†àÏù¥ÏÖòÏùÑ Î®ºÏ†Ä Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            var apiKey = document.getElementById('apiKey').value;
            
            document.getElementById('aiAnalysis').style.display = 'block';
            document.getElementById('analysisResults').innerHTML = '<div class="loading"></div> AIÍ∞Ä ÏúÑÌóò Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...';

            setTimeout(function() {
                try {
                    performThreatPatternAnalysis(apiKey);
                } catch (error) {
                    document.getElementById('analysisResults').innerHTML = '‚ùå ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message;
                    addLog('ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù Ïò§Î•ò: ' + error.message, 'danger');
                }
            }, 2000);
        }

        // ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù ÏàòÌñâ
        function performThreatPatternAnalysis(apiKey) {
            var threatAnalysis = analyzeAgainstBaseline();
            var prompt = generateThreatAnalysisPrompt(threatAnalysis);
            
            if (apiKey && apiKey.length > 20) {
                // ÌîÑÎ°ùÏãúÎ•º ÌÜµÌïú API Ìò∏Ï∂ú ÏãúÎèÑ
                callGeminiThroughProxy(apiKey, prompt).then(function(result) {
                    document.getElementById('analysisResults').innerHTML = result;
                    addLog('ü§ñ Gemini AI ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù ÏôÑÎ£å', 'normal');
                }).catch(function(error) {
                    addLog('Gemini API Ïã§Ìå®, Î°úÏª¨ Î∂ÑÏÑùÏúºÎ°ú Ï†ÑÌôò', 'warning');
                    var localResult = performLocalThreatAnalysis(threatAnalysis);
                    document.getElementById('analysisResults').innerHTML = localResult;
                });
            } else {
                addLog('ÎÇ¥Ïû• AIÎ°ú ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù ÏàòÌñâ', 'normal');
                var localResult = performLocalThreatAnalysis(threatAnalysis);
                document.getElementById('analysisResults').innerHTML = localResult;
            }
        }

        // ÌîÑÎ°ùÏãúÎ•º ÌÜµÌïú Gemini API Ìò∏Ï∂ú
        function callGeminiThroughProxy(apiKey, prompt) {
            var proxyUrls = [
                'https://api.allorigins.win/get?url=',
                'https://cors-anywhere.herokuapp.com/',
                'https://proxy.cors.sh/'
            ];
            
            var geminiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey;
            
            return new Promise(function(resolve, reject) {
                var tryProxy = function(proxyIndex) {
                    if (proxyIndex >= proxyUrls.length) {
                        // Î™®Îì† ÌîÑÎ°ùÏãú Ïã§Ìå® Ïãú ÏßÅÏ†ë Ìò∏Ï∂ú ÏãúÎèÑ
                        return callGeminiDirectly(apiKey, prompt).then(resolve).catch(reject);
                    }
                    
                    var proxyUrl = proxyUrls[proxyIndex] + encodeURIComponent(geminiUrl);
                    
                    fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    }).then(function(response) {
                        if (response.ok) {
                            return response.json().then(function(data) {
                                var actualData = JSON.parse(data.contents || data);
                                if (actualData.candidates && actualData.candidates[0]) {
                                    resolve(formatThreatAnalysisResult(actualData.candidates[0].content.parts[0].text));
                                } else {
                                    throw new Error('Invalid response format');
                                }
                            });
                        } else {
                            throw new Error('Proxy failed');
                        }
                    }).catch(function() {
                        tryProxy(proxyIndex + 1);
                    });
                };
                
                tryProxy(0);
            });
        }

        // ÏßÅÏ†ë Gemini API Ìò∏Ï∂ú
        function callGeminiDirectly(apiKey, prompt) {
            return fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            }).then(function(response) {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Direct API call failed');
                }
            }).then(function(data) {
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return formatThreatAnalysisResult(data.candidates[0].content.parts[0].text);
                } else {
                    throw new Error('Invalid API response');
                }
            });
        }

        // Í∏∞Ï§ÄÏÑ† ÎåÄÎπÑ Î∂ÑÏÑù
        function analyzeAgainstBaseline() {
            var analysis = {
                totalRealtimeEvents: realtimeTraffic.length,
                totalSimulationEvents: simulationData.length,
                highRiskMatches: [],
                mediumRiskMatches: [],
                lowRiskMatches: [],
                averageSimilarity: 0,
                maxSimilarity: 0,
                riskDistribution: { HIGH: 0, MEDIUM: 0, LOW: 0 }
            };

            var allEvents = realtimeTraffic.concat(simulationData);
            var totalSimilarity = 0;

            for (var i = 0; i < allEvents.length; i++) {
                var event = allEvents[i];
                var maxEventSimilarity = 0;
                var bestMatch = null;

                for (var j = 0; j < threatBaseline.length; j++) {
                    var similarity = calculateThreatSimilarity(event, threatBaseline[j]);
                    if (similarity > maxEventSimilarity) {
                        maxEventSimilarity = similarity;
                        bestMatch = threatBaseline[j];
                    }
                }

                var riskLevel = assessRiskLevel(maxEventSimilarity);
                var match = {
                    event: event,
                    similarity: maxEventSimilarity,
                    riskLevel: riskLevel,
                    matchedPattern: bestMatch
                };

                if (riskLevel === 'HIGH') {
                    analysis.highRiskMatches.push(match);
                    analysis.riskDistribution.HIGH++;
                } else if (riskLevel === 'MEDIUM') {
                    analysis.mediumRiskMatches.push(match);
                    analysis.riskDistribution.MEDIUM++;
                } else {
                    analysis.lowRiskMatches.push(match);
                    analysis.riskDistribution.LOW++;
                }

                totalSimilarity += maxEventSimilarity;
                if (maxEventSimilarity > analysis.maxSimilarity) {
                    analysis.maxSimilarity = maxEventSimilarity;
                }
            }

            analysis.averageSimilarity = allEvents.length > 0 ? totalSimilarity / allEvents.length : 0;
            return analysis;
        }

        // ÏúÑÌóò Î∂ÑÏÑù ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
        function generateThreatAnalysisPrompt(analysis) {
            var prompt = "ÎÑ§Ìä∏ÏõåÌÅ¨ Î≥¥Ïïà Ï†ÑÎ¨∏Í∞ÄÎ°úÏÑú Îã§Ïùå ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù Í≤∞Í≥ºÎ•º ÌèâÍ∞ÄÌïòÍ≥† ÌïúÍµ≠Ïñ¥Î°ú ÏÉÅÏÑ∏Ìïú Î≥¥Í≥†ÏÑúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî:\n\n";
            
            prompt += "=== ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ† Ï†ïÎ≥¥ ===\n";
            prompt += "- Îì±Î°ùÎêú ÏúÑÌóò Ìå®ÌÑ¥: " + threatBaseline.length + "Í∞ú\n";
            prompt += "- Ìå®ÌÑ¥ Ïú†Ìòï: Í≥†ÏúÑÌóò Í≥µÍ≤© ÏãúÍ∑∏ÎãàÏ≤ò\n\n";
            
            prompt += "=== Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ Î∂ÑÏÑù Í≤∞Í≥º ===\n";
            prompt += "- Î∂ÑÏÑùÎêú Ïù¥Î≤§Ìä∏: " + (analysis.totalRealtimeEvents + analysis.totalSimulationEvents) + "Í∞ú\n";
            prompt += "- ÌèâÍ∑† Ïú†ÏÇ¨ÎèÑ: " + (analysis.averageSimilarity * 100).toFixed(1) + "%\n";
            prompt += "- ÏµúÎåÄ Ïú†ÏÇ¨ÎèÑ: " + (analysis.maxSimilarity * 100).toFixed(1) + "%\n\n";
            
            prompt += "=== ÏúÑÌóòÎèÑÎ≥Ñ Îß§Ïπ≠ Í≤∞Í≥º ===\n";
            prompt += "- HIGH RISK (70% Ïù¥ÏÉÅ): " + analysis.riskDistribution.HIGH + "Í±¥\n";
            prompt += "- MEDIUM RISK (50-69%): " + analysis.riskDistribution.MEDIUM + "Í±¥\n";
            prompt += "- LOW RISK (50% ÎØ∏Îßå): " + analysis.riskDistribution.LOW + "Í±¥\n\n";
            
            if (analysis.highRiskMatches.length > 0) {
                prompt += "=== Í≥†ÏúÑÌóò Ìå®ÌÑ¥ Îß§Ïπò ÏÉÅÏÑ∏ ===\n";
                for (var i = 0; i < Math.min(5, analysis.highRiskMatches.length); i++) {
                    var match = analysis.highRiskMatches[i];
                    prompt += "- Ïú†ÏÇ¨ÎèÑ " + (match.similarity * 100).toFixed(1) + "%: " + match.event.attackType + " (" + match.event.sourceIP + ")\n";
                }
                prompt += "\n";
            }
            
            prompt += "Îã§Ïùå Ìï≠Î™©Îì§ÏùÑ Ìè¨Ìï®Ìïú ÏúÑÌóò ÌèâÍ∞Ä Î≥¥Í≥†ÏÑúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî:\n";
            prompt += "1. ÌòÑÏû¨ ÎÑ§Ìä∏ÏõåÌÅ¨Ïùò Ï†ÑÎ∞òÏ†ÅÏù∏ ÏúÑÌóò ÏÉÅÌÉú ÌèâÍ∞Ä\n";
            prompt += "2. Í≥†ÏúÑÌóò Ìå®ÌÑ¥ Îß§ÏπòÏóê ÎåÄÌïú ÏÉÅÏÑ∏ Î∂ÑÏÑù\n";
            prompt += "3. ÏúÑÌóò Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑÍ∞Ä ÎÜíÏùÄ Ìä∏ÎûòÌîΩÏùò ÏúÑÌóòÏÑ± ÌèâÍ∞Ä\n";
            prompt += "4. Ï¶âÏãú Ï†ÅÏö©Ìï¥Ïïº Ìï† Î≥¥Ïïà Ï°∞ÏπòÏÇ¨Ìï≠\n";
            prompt += "5. ÏßÄÏÜçÏ†ÅÏù∏ ÏúÑÌóò Ìå®ÌÑ¥ Î™®ÎãàÌÑ∞ÎßÅ Ï†ÑÎûµ\n";
            prompt += "6. Í≥µÍ≤© Ìå®ÌÑ¥ ÏßÑÌôîÏóê ÎåÄÎπÑÌïú ÎåÄÏùë Î∞©Ïïà\n\n";
            prompt += "Ïã§Î¨¥ÏßÑÏù¥ Ï¶âÏãú Ïã§ÌñâÌï† Ïàò ÏûàÎäî Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Ïã§Ìñâ Í∞ÄÎä•Ìïú ÎÇ¥Ïö©ÏúºÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.";
            
            return prompt;
        }

        // Î°úÏª¨ ÏúÑÌóò Î∂ÑÏÑù
        function performLocalThreatAnalysis(analysis) {
            var report = '<div style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">';
            report += '<h3>üö® ÏúÑÌóò Ìå®ÌÑ¥ Î∂ÑÏÑù Î≥¥Í≥†ÏÑú</h3>';
            report += '<p>CSV Í∏∞Ï§ÄÏÑ† ÎåÄÎπÑ Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ ÏúÑÌóòÎèÑ ÌèâÍ∞Ä</p>';
            report += '</div>';
            
            // Ï†ÑÎ∞òÏ†ÅÏù∏ ÏúÑÌóò ÏÉÅÌÉú
            var overallRisk = 'LOW';
            if (analysis.riskDistribution.HIGH > 0 || analysis.averageSimilarity > 0.6) {
                overallRisk = 'HIGH';
            } else if (analysis.riskDistribution.MEDIUM > 5 || analysis.averageSimilarity > 0.4) {
                overallRisk = 'MEDIUM';
            }
            
            report += '<h4 style="color: #fff; margin: 15px 0 10px 0;">üéØ Ï†ÑÎ∞òÏ†ÅÏù∏ ÏúÑÌóò ÏÉÅÌÉú</h4>';
            report += '<div style="margin-left: 20px; background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
            report += '‚Ä¢ <strong>ÌòÑÏû¨ ÏúÑÌóòÎèÑ: ' + overallRisk + '</strong><br>';
            report += '‚Ä¢ ÌèâÍ∑† Ìå®ÌÑ¥ Ïú†ÏÇ¨ÎèÑ: ' + (analysis.averageSimilarity * 100).toFixed(1) + '%<br>';
            report += '‚Ä¢ ÏµúÎåÄ ÏúÑÌóò Ïú†ÏÇ¨ÎèÑ: ' + (analysis.maxSimilarity * 100).toFixed(1) + '%<br>';
            report += '‚Ä¢ Î∂ÑÏÑùÎêú Ï¥ù Ïù¥Î≤§Ìä∏: ' + (analysis.totalRealtimeEvents + analysis.totalSimulationEvents) + 'Í±¥';
            report += '</div>';
            
            // ÏúÑÌóòÎèÑÎ≥Ñ Î∂ÑÌè¨
            report += '<h4 style="color: #fff; margin: 15px 0 10px 0;">üìä ÏúÑÌóò Ìå®ÌÑ¥ Îß§Ïπ≠ Î∂ÑÌè¨</h4>';
            report += '<div style="margin-left: 20px; background: rgba(52, 152, 219, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
            report += 'üî¥ <strong>HIGH RISK (70% Ïù¥ÏÉÅ):</strong> ' + analysis.riskDistribution.HIGH + 'Í±¥<br>';
            report += 'üü° <strong>MEDIUM RISK (50-69%):</strong> ' + analysis.riskDistribution.MEDIUM + 'Í±¥<br>';
            report += 'üü¢ <strong>LOW RISK (50% ÎØ∏Îßå):</strong> ' + analysis.riskDistribution.LOW + 'Í±¥';
            report += '</div>';
            
            // Í≥†ÏúÑÌóò Ìå®ÌÑ¥ ÏÉÅÏÑ∏
            if (analysis.highRiskMatches.length > 0) {
                report += '<h4 style="color: #fff; margin: 15px 0 10px 0;">üö® Í≥†ÏúÑÌóò Ìå®ÌÑ¥ Îß§Ïπò ÏÉÅÏÑ∏</h4>';
                report += '<div style="margin-left: 20px; background: rgba(231, 76, 60, 0.4); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
                for (var i = 0; i < Math.min(5, analysis.highRiskMatches.length); i++) {
                    var match = analysis.highRiskMatches[i];
                    report += '‚ö†Ô∏è <strong>Ïú†ÏÇ¨ÎèÑ ' + (match.similarity * 100).toFixed(1) + '%:</strong> ' + match.event.attackType + '<br>';
                    report += '&nbsp;&nbsp;&nbsp;Ï∂úÎ∞úÏßÄ: ' + match.event.sourceIP + ' ‚Üí Î™©Ï†ÅÏßÄ: ' + match.event.destinationIP + '<br>';
                }
                if (analysis.highRiskMatches.length > 5) {
                    report += '&nbsp;&nbsp;&nbsp;... Ï∂îÍ∞Ä ' + (analysis.highRiskMatches.length - 5) + 'Í±¥Ïùò Í≥†ÏúÑÌóò Îß§Ïπò<br>';
                }
                report += '</div>';
            }
            
            // Ï¶âÏãú Ï°∞ÏπòÏÇ¨Ìï≠
            report += '<h4 style="color: #fff; margin: 15px 0 10px 0;">‚ö° Ï¶âÏãú Ï°∞ÏπòÏÇ¨Ìï≠</h4>';
            report += '<div style="margin-left: 20px;">';
            
            if (analysis.riskDistribution.HIGH > 0) {
                report += 'üö® <strong>Í∏¥Í∏â ÎåÄÏùë:</strong><br>';
                report += '&nbsp;&nbsp;‚Ä¢ Í≥†ÏúÑÌóò IP Ï£ºÏÜå Ï¶âÏãú Ï∞®Îã®<br>';
                report += '&nbsp;&nbsp;‚Ä¢ Î≥¥ÏïàÌåÄ Í∏¥Í∏â ÏÜåÏßë Î∞è ÏÉÅÌô© Í≥µÏú†<br>';
                report += '&nbsp;&nbsp;‚Ä¢ ÏãúÏä§ÌÖú Î°úÍ∑∏ ÏÉÅÏÑ∏ Î∂ÑÏÑù Ïã§Ïãú<br>';
            }
            
            if (analysis.averageSimilarity > 0.4) {
                report += '‚ö†Ô∏è <strong>Ï£ºÏùò Î™®ÎãàÌÑ∞ÎßÅ:</strong><br>';
                report += '&nbsp;&nbsp;‚Ä¢ Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú Í∞ïÌôî<br>';
                report += '&nbsp;&nbsp;‚Ä¢ ÎÑ§Ìä∏ÏõåÌÅ¨ Ìä∏ÎûòÌîΩ ÏÉÅÏÑ∏ Í∞êÏãú<br>';
                report += '&nbsp;&nbsp;‚Ä¢ Ï∂îÍ∞Ä ÏúÑÌóò Ìå®ÌÑ¥ Î∞úÍ≤¨ Ïãú Ï¶âÏãú Î≥¥Í≥†<br>';
            }
            
            report += 'üìã <strong>ÏßÄÏÜçÏ†ÅÏù∏ Î≥¥Ïïà Í∞ïÌôî:</strong><br>';
            report += '&nbsp;&nbsp;‚Ä¢ ÏúÑÌóò Ìå®ÌÑ¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ïÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏<br>';
            report += '&nbsp;&nbsp;‚Ä¢ AI Î™®Îç∏ Ïû¨ÌïôÏäµÏùÑ ÌÜµÌïú ÌÉêÏßÄ Ï†ïÌôïÎèÑ Ìñ•ÏÉÅ<br>';
            report += '&nbsp;&nbsp;‚Ä¢ Îã§Í≥ÑÏ∏µ Î≥¥Ïïà ÏïÑÌÇ§ÌÖçÏ≤ò Íµ¨Ï∂ï<br>';
            report += '&nbsp;&nbsp;‚Ä¢ Ï†ïÍ∏∞Ï†ÅÏù∏ Î≥¥Ïïà Ï∑®ÏïΩÏ†ê Ï†êÍ≤Ä Î∞è Ìå®Ïπò';
            report += '</div>';
            
            return report;
        }

        // ÏúÑÌóò Î∂ÑÏÑù Í≤∞Í≥º Ìè¨Îß∑ÌåÖ
        function formatThreatAnalysisResult(text) {
            return text
                .replace(/## (.*)/g, '<h4 style="color: #fff; margin: 15px 0 10px 0;">$1</h4>')
                .replace(/### (.*)/g, '<h5 style="color: #ecf0f1; margin: 10px 0 8px 0;">$1</h5>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/- (.*)/g, '<div style="margin-left: 20px;">‚Ä¢ $1</div>');
        }

        // ÏúÑÌóò Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë
        function startThreatMonitoring() {
            if (threatBaseline.length === 0) {
                alert('ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ†Ïù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. CSV ÌååÏùºÏùÑ Î®ºÏ†Ä ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (monitoringActive) return;
            
            monitoringActive = true;
            realtimeTraffic = [];
            addLog('üî¥ ÏúÑÌóò Ìå®ÌÑ¥ Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë - Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩÏùÑ ÏúÑÌóò Í∏∞Ï§ÄÏÑ†Í≥º ÎπÑÍµê Ï§ë', 'danger');
            updateSystemStatus('MONITORING');
            
            var monitoringInterval = setInterval(function() {
                if (!monitoringActive) {
                    clearInterval(monitoringInterval);
                    return;
                }
                
                // Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ ÏÉùÏÑ± (Ï†ïÏÉÅ 80%, ÏùòÏã¨ 20%)
                var event = generateRealtimeTrafficEvent();
                realtimeTraffic.push(event);
                
                // ÏúÑÌóò Ìå®ÌÑ¥Í≥º ÎπÑÍµê
                var maxSimilarity = 0;
                var bestMatch = null;
                
                for (var i = 0; i < threatBaseline.length; i++) {
                    var similarity = calculateThreatSimilarity(event, threatBaseline[i]);
                    if (similarity > maxSimilarity) {
                        maxSimilarity = similarity;
                        bestMatch = threatBaseline[i];
                    }
                }
                
                var riskLevel = assessRiskLevel(maxSimilarity);
                var timestamp = new Date().toLocaleTimeString();
                totalPackets++;
                
                // ÏúÑÌóòÎèÑÏóê Îî∞Î•∏ Ï≤òÎ¶¨
                if (riskLevel === 'HIGH') {
                    riskMatches++;
                    addLog('[' + timestamp + '] üö® HIGH RISK: ' + event.attackType + ' (Ïú†ÏÇ¨ÎèÑ ' + (maxSimilarity * 100).toFixed(1) + '%) - ' + event.sourceIP, 'high-risk');
                    
                    // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏãúÍ∞ÅÌôî ÏóÖÎç∞Ïù¥Ìä∏
                    updateNetworkNode('high-risk');
                    
                } else if (riskLevel === 'MEDIUM') {
                    riskMatches++;
                    addLog('[' + timestamp + '] ‚ö†Ô∏è MEDIUM RISK: ' + event.attackType + ' (Ïú†ÏÇ¨ÎèÑ ' + (maxSimilarity * 100).toFixed(1) + '%) - ' + event.sourceIP, 'warning');
                    updateNetworkNode('medium-risk');
                    
                } else {
                    addLog('[' + timestamp + '] ‚úÖ LOW RISK: ' + event.attackType + ' (Ïú†ÏÇ¨ÎèÑ ' + (maxSimilarity * 100).toFixed(1) + '%)', 'normal');
                }
                
                // Ï†ÑÏ≤¥ ÌèâÍ∑† Ïú†ÏÇ¨ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                updateAverageSimilarity();
                updateCurrentRiskLevel(riskLevel);
                updateMetrics();
                
                // Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ Ï†úÌïú
                if (realtimeTraffic.length > 100) {
                    realtimeTraffic = realtimeTraffic.slice(-50);
                }
                
            }, 2000);
        }

        // Ïã§ÏãúÍ∞Ñ Ìä∏ÎûòÌîΩ Ïù¥Î≤§Ìä∏ ÏÉùÏÑ±
        function generateRealtimeTrafficEvent() {
            var eventTypes = [
                // Ï†ïÏÉÅ Ìä∏ÎûòÌîΩ (80%)
                { type: 'HTTP_REQUEST', protocol: 'HTTP', port: 80, size: 500, threat: false, weight: 25 },
                { type: 'HTTPS_REQUEST', protocol: 'HTTPS', port: 443, size: 600, threat: false, weight: 25 },
                { type: 'DNS_QUERY', protocol: 'DNS', port: 53, size: 100, threat: false, weight: 15 },
                { type: 'SSH_LOGIN', protocol: 'SSH', port: 22, size: 200, threat: false, weight: 10 },
                { type: 'EMAIL_TRANSFER', protocol: 'SMTP', port: 25, size: 800, threat: false, weight: 5 },
                
                // ÏùòÏã¨ Ìä∏ÎûòÌîΩ (20%)
                { type: 'PORT_SCAN', protocol: 'TCP', port: 80, size: 100, threat: true, weight: 8 },
                { type: 'BRUTE_FORCE', protocol: 'SSH', port: 22, size: 150, threat: true, weight: 5 },
                { type: 'DDoS_ATTEMPT', protocol: 'TCP', port: 80, size: 1500, threat: true, weight: 4 },
                { type: 'MALWARE_C2', protocol: 'HTTPS', port: 443, size: 2000, threat: true, weight: 3 }
            ];
            
            // Í∞ÄÏ§ëÏπò Í∏∞Î∞ò ÏÑ†ÌÉù
            var totalWeight = eventTypes.reduce(function(sum, e) { return sum + e.weight; }, 0);
            var random = Math.random() * totalWeight;
            var currentWeight = 0;
            var selectedEvent;
            
            for (var i = 0; i < eventTypes.length; i++) {
                currentWeight += eventTypes[i].weight;
                if (random <= currentWeight) {
                    selectedEvent = eventTypes[i];
                    break;
                }
            }
            
            return {
                uid: 'realtime_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                timestamp: Date.now(),
                protocol: selectedEvent.protocol,
                sourceIP: generateVariedIP(),
                destinationIP: '192.168.1.' + (Math.floor(Math.random() * 100) + 1),
                sourcePort: Math.floor(Math.random() * 65535),
                destinationPort: selectedEvent.port + Math.floor(Math.random() * 10),
                packetSize: selectedEvent.size + Math.floor(Math.random() * 200),
                directionType: Math.random() > 0.5 ? 0 : 1,
                eventCount: Math.floor(Math.random() * 50) + 1,
                attackType: selectedEvent.type,
                severity: selectedEvent.threat ? 'HIGH' : 'LOW',
                dataType: 'realtime'
            };
        }

        // Îã§ÏñëÌïú IP ÏÉùÏÑ±
        function generateVariedIP() {
            var ipTypes = [
                // ÎÇ¥Î∂Ä ÎÑ§Ìä∏ÏõåÌÅ¨ (60%)
                '192.168.1.' + (Math.floor(Math.random() * 254) + 1),
                '192.168.0.' + (Math.floor(Math.random() * 254) + 1),
                '10.0.0.' + (Math.floor(Math.random() * 254) + 1),
                
                // Ïô∏Î∂Ä IP (40%)
                '203.0.113.' + (Math.floor(Math.random() * 254) + 1),
                '198.51.100.' + (Math.floor(Math.random() * 254) + 1),
                '185.220.101.' + (Math.floor(Math.random() * 254) + 1)
            ];
            
            return ipTypes[Math.floor(Math.random() * ipTypes.length)];
        }

        // ÏúÑÌóò ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë
        function startThreatSimulation() {
            if (threatBaseline.length === 0) {
                alert('ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ†Ïù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. CSV ÌååÏùºÏùÑ Î®ºÏ†Ä ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (simulationActive) return;
            
            simulationActive = true;
            simulationData = [];
            addLog('üé≠ ÏúÑÌóò ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë - Í≥†ÏúÑÌóò Ìå®ÌÑ¥Í≥º Ïú†ÏÇ¨Ìïú Í≥µÍ≤© Ìä∏ÎûòÌîΩ ÏÉùÏÑ±', 'danger');
            
            var attackCount = 0;
            var simulationInterval = setInterval(function() {
                if (attackCount >= 15 || !simulationActive) {
                    clearInterval(simulationInterval);
                    simulationActive = false;
                    addLog('üé≠ ÏúÑÌóò ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏôÑÎ£å - Ï¥ù ' + simulationData.length + 'Í∞ú ÏãúÎÆ¨Î†àÏù¥ÏÖò Í≥µÍ≤© ÏÉùÏÑ±', 'warning');
                    return;
                }
                
                // Í∏∞Ï§ÄÏÑ†Í≥º Ïú†ÏÇ¨Ìïú Í≥†ÏúÑÌóò Ïù¥Î≤§Ìä∏ ÏÉùÏÑ±
                var simulatedAttack = generateHighRiskEvent();
                simulationData.push(simulatedAttack);
                
                // Í∏∞Ï§ÄÏÑ†Í≥º Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
                var maxSimilarity = 0;
                for (var i = 0; i < threatBaseline.length; i++) {
                    var similarity = calculateThreatSimilarity(simulatedAttack, threatBaseline[i]);
                    if (similarity > maxSimilarity) {
                        maxSimilarity = similarity;
                    }
                }
                
                var timestamp = new Date().toLocaleTimeString();
                totalPackets++;
                riskMatches++;
                
                var riskLevel = assessRiskLevel(maxSimilarity);
                addLog('[' + timestamp + '] üö® ÏãúÎÆ¨Î†àÏù¥ÏÖò ' + riskLevel + ' RISK: ' + simulatedAttack.attackType + ' (Ïú†ÏÇ¨ÎèÑ ' + (maxSimilarity * 100).toFixed(1) + '%)', 'high-risk');
                
                updateNetworkNode(riskLevel.toLowerCase() + '-risk');
                updateMetrics();
                attackCount++;
                
            }, 1500);
        }

        // Í≥†ÏúÑÌóò Ïù¥Î≤§Ìä∏ ÏÉùÏÑ± (Í∏∞Ï§ÄÏÑ†Í≥º Ïú†ÏÇ¨ÌïòÍ≤å)
        function generateHighRiskEvent() {
            var highRiskPatterns = [
                { type: 'ADVANCED_PERSISTENT_THREAT', protocol: 'TCP', port: 443, size: 2048 },
                { type: 'SQL_INJECTION', protocol: 'HTTP', port: 80, size: 1200 },
                { type: 'RANSOMWARE_C2', protocol: 'HTTPS', port: 8080, size: 1500 },
                { type: 'ZERO_DAY_EXPLOIT', protocol: 'TCP', port: 445, size: 3000 },
                { type: 'LATERAL_MOVEMENT', protocol: 'SMB', port: 445, size: 800 },
                { type: 'DATA_EXFILTRATION', protocol: 'HTTPS', port: 443, size: 4096 },
                { type: 'CRYPTOMINING_MALWARE', protocol: 'TCP', port: 4444, size: 600 },
                { type: 'PHISHING_CAMPAIGN', protocol: 'HTTP', port: 80, size: 1000 }
            ];
            
            var pattern = highRiskPatterns[Math.floor(Math.random() * highRiskPatterns.length)];
            var maliciousIPs = ['203.0.113.666', '198.51.100.999', '185.220.101.777'];
            
            return {
                uid: 'sim_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                timestamp: Date.now(),
                protocol: pattern.protocol,
                sourceIP: maliciousIPs[Math.floor(Math.random() * maliciousIPs.length)],
                destinationIP: '192.168.1.' + (Math.floor(Math.random() * 100) + 1),
                sourcePort: Math.floor(Math.random() * 65535),
                destinationPort: pattern.port,
                packetSize: pattern.size + Math.floor(Math.random() * 500),
                directionType: 0,
                eventCount: Math.floor(Math.random() * 500) + 100,
                attackType: pattern.type,
                severity: 'CRITICAL',
                dataType: 'simulation'
            };
        }

        // ÏúÑÌóò Ìå®ÌÑ¥ ÏÉòÌîå ÏÉùÏÑ±
        function generateThreatPatterns() {
            var samplePatterns = [
                {
                    uid: 'threat_001',
                    protocol: 'TCP',
                    sourceIP: '203.0.113.666',
                    destinationIP: '192.168.1.100',
                    sourcePort: 12345,
                    destinationPort: 80,
                    packetSize: 1500,
                    directionType: 0,
                    eventCount: 200,
                    attackType: 'HTTP_FLOOD',
                    severity: 'HIGH',
                    dataType: 'threat_baseline'
                },
                {
                    uid: 'threat_002',
                    protocol: 'SSH',
                    sourceIP: '198.51.100.999',
                    destinationIP: '192.168.1.50',
                    sourcePort: 54321,
                    destinationPort: 22,
                    packetSize: 150,
                    directionType: 0,
                    eventCount: 500,
                    attackType: 'SSH_BRUTE_FORCE',
                    severity: 'CRITICAL',
                    dataType: 'threat_baseline'
                },
                {
                    uid: 'threat_003',
                    protocol: 'HTTPS',
                    sourceIP: '185.220.101.777',
                    destinationIP: '192.168.1.200',
                    sourcePort: 443,
                    destinationPort: 443,
                    packetSize: 2048,
                    directionType: 1,
                    eventCount: 300,
                    attackType: 'MALWARE_C2',
                    severity: 'HIGH',
                    dataType: 'threat_baseline'
                }
            ];

            threatBaseline = samplePatterns;
            addLog('‚ö†Ô∏è ÏúÑÌóò Ìå®ÌÑ¥ ÏÉòÌîå ÏÉùÏÑ± ÏôÑÎ£å (' + samplePatterns.length + 'Í∞ú Í≥†ÏúÑÌóò Ìå®ÌÑ¥)', 'danger');
            updateSystemStatus('BASELINE_LOADED');
            updateMetrics();
        }

        // ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateSystemStatus(status) {
            var indicator = document.getElementById('systemStatus');
            var riskIndicator = document.querySelector('.risk-indicator');
            
            switch(status) {
                case 'BASELINE_LOADED':
                    indicator.style.background = '#f39c12';
                    indicator.className = 'risk-indicator medium';
                    break;
                case 'MONITORING':
                    indicator.style.background = '#e74c3c';
                    indicator.className = 'risk-indicator high';
                    break;
                default:
                    indicator.style.background = '#27ae60';
                    indicator.className = 'status-indicator';
            }
        }

        // ÌèâÍ∑† Ïú†ÏÇ¨ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAverageSimilarity() {
            var allEvents = realtimeTraffic.concat(simulationData);
            if (allEvents.length === 0) return;
            
            var totalSimilarity = 0;
            var eventCount = 0;
            
            for (var i = 0; i < allEvents.length; i++) {
                var event = allEvents[i];
                var maxSimilarity = 0;
                
                for (var j = 0; j < threatBaseline.length; j++) {
                    var similarity = calculateThreatSimilarity(event, threatBaseline[j]);
                    if (similarity > maxSimilarity) {
                        maxSimilarity = similarity;
                    }
                }
                
                totalSimilarity += maxSimilarity;
                eventCount++;
            }
            
            averageSimilarity = eventCount > 0 ? totalSimilarity / eventCount : 0;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('avgSimilarity').textContent = (averageSimilarity * 100).toFixed(1) + '%';
            document.getElementById('similarityFill').style.width = (averageSimilarity * 100) + '%';
        }

        // ÌòÑÏû¨ ÏúÑÌóòÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCurrentRiskLevel(latestRiskLevel) {
            currentRiskLevel = latestRiskLevel;
            var riskElement = document.getElementById('currentRiskLevel');
            
            switch(latestRiskLevel) {
                case 'HIGH':
                    riskElement.textContent = 'HIGH RISK';
                    riskElement.style.color = '#e74c3c';
                    break;
                case 'MEDIUM':
                    riskElement.textContent = 'MEDIUM RISK';
                    riskElement.style.color = '#f39c12';
                    break;
                case 'LOW':
                    riskElement.textContent = 'LOW RISK';
                    riskElement.style.color = '#27ae60';
                    break;
                default:
                    riskElement.textContent = 'UNKNOWN';
                    riskElement.style.color = '#95a5a6';
            }
        }

        // ÎÑ§Ìä∏ÏõåÌÅ¨ ÎÖ∏Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateNetworkNode(riskClass) {
            var nodes = document.querySelectorAll('.network-node');
            var randomNode = nodes[Math.floor(Math.random() * nodes.length)];
            
            // Í∏∞Ï°¥ ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            randomNode.classList.remove('high-risk', 'medium-risk', 'low-risk');
            
            // ÏÉà ÏúÑÌóòÎèÑ ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            randomNode.classList.add(riskClass);
            
            // ÏùºÏ†ï ÏãúÍ∞Ñ ÌõÑ ÏõêÎûòÎåÄÎ°ú Î≥µÏõê
            setTimeout(function() {
                randomNode.classList.remove(riskClass);
            }, riskClass === 'high-risk' ? 8000 : 5000);
        }

        // Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ
        function stopMonitoring() {
            monitoringActive = false;
            simulationActive = false;
            addLog('‚èπÔ∏è ÏúÑÌóò Ìå®ÌÑ¥ Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ (Ïã§ÏãúÍ∞Ñ: ' + realtimeTraffic.length + 'Í±¥, ÏãúÎÆ¨Î†àÏù¥ÏÖò: ' + simulationData.length + 'Í±¥)', 'warning');
            updateSystemStatus('STOPPED');
        }

        // Î©îÌä∏Î¶≠ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMetrics() {
            document.getElementById('totalPackets').textContent = totalPackets.toLocaleString();
            document.getElementById('riskMatches').textContent = riskMatches.toLocaleString();
        }

        // Î°úÍ∑∏ Ï∂îÍ∞Ä
        function addLog(message, type) {
            type = type || 'normal';
            var logContainer = document.getElementById('logContainer');
            var logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + type;
            logEntry.textContent = message;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            var logs = logContainer.querySelectorAll('.log-entry');
            if (logs.length > 50) {
                logs[0].remove();
            }
        }

        // ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initNetworkVisualization();
            setupFileUpload();
            addLog('üõ°Ô∏è AI Í∏∞Î∞ò ÏúÑÌóò Ìå®ÌÑ¥ ÌÉêÏßÄ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§.', 'normal');
            addLog('‚ö†Ô∏è CSV ÌååÏùºÎ°ú ÏúÑÌóò Ìå®ÌÑ¥ Í∏∞Ï§ÄÏÑ†ÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
        });
    </script>
</body>
</html>